<!--<!DOCTYPE html>-->
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>lou.springboot | 用户管理页</title>
    <!-- jqgrid ui -->
    <link href="/plugins/jqGrid-5.4.0/ui.jqgrid-bootstrap.css" rel="stylesheet"/>
    <link rel="stylesheet" href="/plugins/bootstrap/js/css/bootstrap.css">
    <link rel="stylesheet" href="/plugins/fontawesome-free/css/all.min.css">
    <link rel="stylesheet" href="/plugins/overlayScrollbars/css/OverlayScrollbars.min.css">
    <!-- sweet alert -->
    <!--    <link rel="stylesheet" href="plugins/sweetalert/sweetalert.css">-->
<!--    <link href="/plugins/bootstrap/js/css/bootstrap.min.css" rel="stylesheet"/>-->
    <link href="/dist/css/main.css" rel="stylesheet"/>
    <!-- Tell the browser to be responsive to screen width -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="/plugins/fontawesome-free/css/fontawesome.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="/dist/css/adminlte.css">
    <!-- sweet alert -->
    <link rel="stylesheet" href="/plugins/sweetalert2/sweetalert2.css">
    <link rel="stylesheet" href="/plugins/daterangepicker/daterangepicker.css">
      <link href="https://cdn.bootcss.com/bootstrap-table/1.11.1/bootstrap-table.min.css" rel="stylesheet">
      <!-- Select2 -->
      <link rel="stylesheet" href="/plugins/select2/css/select2.min.css">
      <link rel="stylesheet" href="/plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css">
      <link rel="stylesheet" href="https://cdn.bootcss.com/jquery-treegrid/0.2.0/css/jquery.treegrid.min.css">
    <style>
      body{padding: 20px;}
      .demo-input{padding-left: 10px; height: 38px; min-width: 262px; line-height: 38px; border: 1px solid #e6e6e6;  background-color: #fff;  border-radius: 2px;}
      .demo-footer{padding: 50px 0; color: #999; font-size: 14px;}
      .demo-footer a{padding: 0 5px; color: #01AAED;}
      .round_icon{
        width: 34px;
        height: 34px;
        display: flex;
        border-radius: 50%;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        margin: auto;
        left: 50%;
        right: 50%;
        top: 50%;
        bottom: 50%;
        text-align: center;
      }
    </style>
    <link rel="stylesheet" href="/dist/css/laydate/theme/default/laydate.css">
    <style>
      ::-webkit-scrollbar{
        display:none;
      }
    </style>
  </head>
  <body>
    <div class="wrapper" style="padding-top : 3%;padding-bottom : 3%;padding-left: 1%">
      <!-- Content Wrapper. Contains page content -->
      <div style="margin-left: 0px;" id="content-wrapper-user" class="content-wrapper">

        <!-- Main content -->
          <div class="content">
              <div class="row">
                  <div class="col-12">
                      <div class="card" style="font-size: 14px">
<!--                          <div class="card-body"style="margin-top: 40px;margin-bottom: -30px;margin-left: 50px;">-->
<!--                              <div style="width: 50%;float: left;text-align: left">-->
<!--                                  <h1>角色权限树</h1>-->
<!--                              </div>-->
<!--                              <div style="width: 50%;float: right;text-align: right">-->
<!--                                  <button class="btn btn-block btn-info" id="assignPermission"-->
<!--                                          style="display: inline-block;width: 15%; font-size: 14px;margin-right: 40px">&nbsp;权限配置-->
<!--                                  </button>-->
<!--                                  &lt;!&ndash;                                        <button class="btn btn-block btn-info" id="downloadByCondition"&ndash;&gt;-->
<!--                                  &lt;!&ndash;                                                style="display: inline-block;width: 15%;margin-right: 5%;margin-top: 0px;">&ndash;&gt;-->
<!--                                  &lt;!&ndash;                                            <i&ndash;&gt;-->
<!--                                  &lt;!&ndash;                                                    class="glyphicon glyphicon-save	"></i>&nbsp;导出&ndash;&gt;-->
<!--                                  &lt;!&ndash;                                        </button>&ndash;&gt;-->
<!--                              </div>-->

<!--                          </div>-->
                          <div class="card-body">
                              <form id="editForm">
                                  <div class="form-group">
                                      <div class="alert alert-danger add-error-info">错误信息展示栏。</div>
                                  </div>
<!--                                  <tr>-->
<!--                                      <td style="width: 120px;">-->
<!--                                          <label >角色名称：<span style="color: red;">*</span></label>-->
<!--                                      </td>-->
<!--                                      <td>-->
<!--                                          <select class="form-control custom-select" id="roleName">-->
<!--                                              <option selected="" disabled=""><font style="vertical-align: inherit;"><font-->
<!--                                                      style="vertical-align: inherit;">选择一个</font></font></option>-->

<!--                                          </select>-->
<!--                                      </td>-->
<!--                                  </tr>-->
                                  <tr>
                                      <td>
                                          <label style="margin-bottom: -50px">接口权限配置：<span style="color: red;">*</span></label>
                                      </td>
                                      <td>
                                          <div class="card-body">
                                              <div class="wrapper" style="padding-top : 3%;padding-bottom : 3%;padding-left: 1%">
                                                  <div class="container">

                                                      <table id="table"></table>
                                                      <br/>
                                                      <button class="btn btn-block btn-info" id="assignPermission" onclick="test()"
                                                              style="display: inline-block;width: 15%;margin-right: 5%;margin-top: 0px;">
                                                          <i
                                                                  class="glyphicon glyphicon-save	"></i>&nbsp;分配
                                                      </button>
                                                  </div>
                                              </div>
                                          </div>
                                      </td>
                                  </tr>
                                  </table>
                              </form>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
      </div>


    </div>
    <!-- ./wrapper -->
    <!-- jQuery -->
    <script src="/plugins/jquery/jquery.min.js"></script>
      <script src="https://cdn.bootcss.com/bootstrap-table/1.12.1/bootstrap-table.min.js"></script>
      <script src="https://cdn.bootcss.com/bootstrap-table/1.12.0/extensions/treegrid/bootstrap-table-treegrid.js"></script>
      <script src="https://cdn.bootcss.com/jquery-treegrid/0.2.0/js/jquery.treegrid.min.js"></script>
      <script src="/plugins/select2/js/select2.full.min.js"></script>
    <!-- jQuery UI 1.11.4 -->
    <script src="/plugins/jquery-ui/jquery-ui.min.js"></script>

    <!-- sweet alert -->
    <script src="/plugins/sweetalert2/sweetalert2.min.js"></script>
    <!-- Bootstrap 4 -->
    <script src="/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="/plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js"></script>
    <script src="/plugins/jqGrid-5.4.0/grid.locale-cn.js"></script>
    <script src="/plugins/jqGrid-5.4.0/jquery.jqGrid.min.js"></script>
    <!--    <script src="/dist/js/public.js"></script>-->
    <script src="/dist/js/user.js"></script>
    <script src="/dist/js/adminlte.js"></script>
    <script src="/dist/js/demo.js"></script>
    <script src="/dist/css/laydate/laydate.js"></script> <!-- 改成你的路径 -->
    <script src="/plugins/moment/moment.min.js"></script>
    <script src="/plugins/daterangepicker/daterangepicker.js"></script>
      <script>
          /**
           * 选中父项时，同时选中子项
           * @param datas 所有的数据
           * @param row 当前数据
           * @param id id 字段名
           * @param pid 父id字段名
           */
          function selectChilds(datas, row, id, pid, checked) {
              for (var i in datas) {
                  if (datas[i][pid] == row[id]) {
                      datas[i].check = checked;
                      selectChilds(datas, datas[i], id, pid, checked);
                  }
                  ;
              }
          }

          function selectParentChecked(datas, row, id, pid) {
              for (var i in datas) {
                  if (datas[i][id] == row[pid]) {
                      datas[i].check = true;
                      selectParentChecked(datas, datas[i], id, pid);
                  }
                  ;
              }
          }

          function test() {
              var selRows = $table.bootstrapTable("getSelections");
              if (selRows.length == 0) {
                  alert("请至少选择一行");
                  return;
              }

              var postData = "";
              $.each(selRows, function (i) {
                  postData += this.id;
                  if (i < selRows.length - 1) {
                      postData += "， ";
                  }
              });
              // alert("你选中行的 id 为：" + postData);
                alert("权限分配成功")
          }

          function add(id) {
              alert("add 方法 , id = " + id);
          }

          function del(id) {
              alert("del 方法 , id = " + id);
          }

          function update(id) {
              alert("update 方法 , id = " + id);
          }


      </script>
      <script type="text/javascript">
          var $table = $('#table');
          var data = new Array();
          $(function () {

              // let reqData=[]
              $('#assignPermission').click(function () {
                  var finalData=[];
                  var selRows = $table.bootstrapTable("getSelections");
                  if (selRows.length == 0) {
                      alert("请至少选择一行");
                      return;
                  }

                  var postData = "";
                  $.each(selRows, function (i) {
                      postData += this.id;
                      if (i < selRows.length - 1) {
                          postData += "， ";
                      }

                      console.log("postData:",postData.split("， "))

                  });
                  let splitData = postData.split("， ");
                  splitData.forEach(function (item) {
                      var tempData={"id":item};
                      finalData.push(tempData);
                  });
                  $.ajax({
                      type: "POST",
                      url: "role/assignPermission",
                      dataType: "json",
                      contentType: "application/json; charset=utf-8",
                      data : JSON.stringify(finalData),
                      success: function (result) {
                          if (result.code === "000_000_000"){
                              alert(result.data);
                          }else {
                              alert("权限分配失败")
                          }
                      }
                  });
              });

              $.ajax({
                  type: "GET",
                  url: "/role/qryRolePermission",
                  dataType: "json",
                  success: function (result) {
                      data = result.data;
                      console.log("后台数据:{}", data)
                      //控制台输出一下数据
                      // console.log(JSON.stringify(data));

                      $table.bootstrapTable({
                          data: data,
                          idField: 'id',
                          dataType: 'json',
                          columns: [
                              {
                                  field: 'check', checkbox: true, formatter: function (value, row, index) {
                                      if (row.check == true) {
                                          // console.log(row.serverName);
                                          //设置选中
                                          return {checked: true};
                                      }
                                  }
                              },
                              {field: 'name', title: '名称'},
                              // {field: 'id', title: '编号', sortable: true, align: 'center'},
                              // {field: 'pid', title: '所属上级'},
                              // { field: 'status',  title: '状态', sortable: true,  align: 'center', formatter: 'statusFormatter'  },
                              {field: 'remark', title: '描述'},
                              // { field: 'operate', title: '操作', align: 'center', events : operateEvents, formatter: 'operateFormatter' },
                          ],

                          // bootstrap-table-treegrid.js 插件配置 -- start

                          //在哪一列展开树形
                          treeShowField: 'name',
                          //指定父id列
                          parentIdField: 'pid',

                          onResetView: function (data) {
                              //console.log('load');
                              $table.treegrid({
                                  initialState: 'collapsed',// 所有节点都折叠
                                  // initialState: 'expanded',// 所有节点都展开，默认展开
                                  treeColumn: 1,
                                  // expanderExpandedClass: 'glyphicon glyphicon-minus',  //图标样式
                                  // expanderCollapsedClass: 'glyphicon glyphicon-plus',
                                  onChange: function () {
                                      $table.bootstrapTable('resetWidth');
                                  }
                              });

                              //只展开树形的第一级节点
                              $table.treegrid('getRootNodes').treegrid('expand');

                          },
                          onCheck: function (row) {
                              var datas = $table.bootstrapTable('getData');
                              // 勾选子类
                              selectChilds(datas, row, "id", "pid", true);

                              // 勾选父类
                              selectParentChecked(datas, row, "id", "pid")

                              // 刷新数据
                              $table.bootstrapTable('load', datas);
                          },

                          onUncheck: function (row) {
                              var datas = $table.bootstrapTable('getData');
                              selectChilds(datas, row, "id", "pid", false);
                              $table.bootstrapTable('load', datas);
                          },
                          // bootstrap-table-treetreegrid.js 插件配置 -- end
                      });
                  }
              });

          });

          // 格式化按钮
          function operateFormatter(value, row, index) {
              return [
                  '<button type="button" class="RoleOfadd btn-small  btn-primary" style="margin-right:15px;"><i class="fa fa-plus" ></i>&nbsp;新增</button>',
                  '<button type="button" class="RoleOfedit btn-small   btn-primary" style="margin-right:15px;"><i class="fa fa-pencil-square-o" ></i>&nbsp;修改</button>',
                  '<button type="button" class="RoleOfdelete btn-small   btn-primary" style="margin-right:15px;"><i class="fa fa-trash-o" ></i>&nbsp;删除</button>'
              ].join('');

          }

          // 格式化类型
          function typeFormatter(value, row, index) {
              if (value === 'menu') {
                  return '菜单';
              }
              if (value === 'button') {
                  return '按钮';
              }
              if (value === 'api') {
                  return '接口';
              }
              return '-';
          }

          // 格式化状态
          function statusFormatter(value, row, index) {
              if (value === 1) {
                  return '<span class="label label-success">正常</span>';
              } else {
                  return '<span class="label label-default">锁定</span>';
              }
          }

          //初始化操作按钮的方法
          window.operateEvents = {
              'click .RoleOfadd': function (e, value, row, index) {
                  add(row.id);
              },
              'click .RoleOfdelete': function (e, value, row, index) {
                  del(row.id);
              },
              'click .RoleOfedit': function (e, value, row, index) {
                  update(row.id);
              }
          };
      </script>

    <script>
      $(function () {
        $('#reservation').daterangepicker({
          maxDate: moment(), //最大时间
          dateLimit: {
            days: 30
          }, //起止时间的最大间隔
          showWeekNumbers: true, //是否显示第几周
          timePicker: false, //是否显示小时和分钟
          timePickerIncrement: 60, //时间的增量，单位为分钟
          timePicker12Hour: false, //是否使用12小时制来显示时间
          locale: {
            applyLabel: '确定',
            cancelLabel: '取消',
            fromLabel: '起始时间',
            toLabel: '结束时间',
            customRangeLabel: '手动选择',
            daysOfWeek: ['日', '一', '二', '三', '四', '五', '六'],
            monthNames: ['一月', '二月', '三月', '四月', '五月', '六月',
              '七月', '八月', '九月', '十月', '十一月', '十二月'
            ],
            firstDay: 1
          }
        }, function(start, end, label) {
          console.log("New date range selected: ' + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD') + ' (predefined range: ' + label + ')");

        });
      });

    // document.getElementById("content-wrapper-user").style.minHeight="400px !important";
      lay('#version').html('-v'+ laydate.v);

      //执行一个laydate实例
      laydate.render({
        elem: '.test1' //指定元素
      });
    </script>
  </body>
</html>