<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yicheng.tourism.mapper.ext.StoreMapperExt">

    <select id="getStore" resultType="com.yicheng.tourism.entity.Store">
        select t1.*
        from t_store t1,t_user_store t2
        where t1.id = t2.store_id and t2.user_id =#{storeId} and t2.create_by =#{storeId}
    </select>
    <select id="qryByCondition" parameterType="com.yicheng.tourism.dto.store.req.StoreQueryReq"
            resultMap="com.yicheng.tourism.mapper.StoreMapper.BaseResultMap">
        select t1.*,t2.nick_name nickName
        from t_store t1,t_user t2
        <include refid="query_sql_where"></include>
    </select>
    <sql id="query_sql_where">
        <where>
            AND t1.create_by = t2.user_name
            <if test="c.id != null and '' != c.id">
                and t1.id=#{c.id}
            </if>
            <if test="c.storeName != null and '' != c.storeName">
                and t1.store_name like concat("%",#{c.storeName},"%")
            </if>
            <if test="c.createBy != null and '' != c.createBy">
                and t1.create_by like concat("%",#{c.createBy},"%")
            </if>
        </where>
    </sql>

    <update id="updateStore" parameterType="com.yicheng.tourism.entity.Store">
        update t_store
        <set>
            <if test="c.storeName != null">
                store_name = #{c.storeName,jdbcType=VARCHAR},
            </if>
            <if test="c.authorPhone != null">
                author_phone = #{c.authorPhone,jdbcType=VARCHAR},
            </if>
            <if test="c.storeScript != null">
                store_script = #{c.storeScript,jdbcType=VARCHAR},
            </if>
            <if test="c.storeState != null">
                store_state = #{c.storeState,jdbcType=CHAR},
            </if>
            <if test="c.updateBy != null">
                update_by = #{c.updateBy,jdbcType=VARCHAR},
            </if>
            update_time = now()

        </set>
        where id=#{c.id}
    </update>

    <delete id="deleteStore" parameterType="com.yicheng.tourism.entity.Store">
    	delete from t_store where id = #{id}
  	</delete>


    <insert id="insertStore" parameterType="com.yicheng.tourism.entity.Store">
        INSERT INTO t_store
        (id, store_number, store_name,
        store_script, author_phone, store_state,
        create_by, create_time)
        VALUES
        (#{c.id,jdbcType=VARCHAR},
        #{c.storeNumber,jdbcType=VARCHAR},
        #{c.storeName,jdbcType=VARCHAR},
        #{c.storeScript,jdbcType=VARCHAR},
        #{c.authorPhone,jdbcType=VARCHAR},
        #{c.storeState,jdbcType=VARCHAR},
        #{c.createBy,jdbcType=VARCHAR},
        now())
    </insert>

    <insert id="insertBatch" parameterType="list">
        INSERT INTO t_store
        (id, store_head,store_number, store_name,
        store_script, author_phone, store_state,
        create_by, create_time)
        VALUES
        <foreach collection="list" item="item" index="index" separator=",">
            (#{item.id,jdbcType=VARCHAR},  #{item.storeHead,jdbcType=VARCHAR},#{item.storeNumber,jdbcType=VARCHAR}, #{item.storeName,jdbcType=VARCHAR},
            #{item.storeScript,jdbcType=VARCHAR}, #{item.authorPhone,jdbcType=DOUBLE}, #{item.storeState,jdbcType=VARCHAR},
            #{item.createBy,jdbcType=VARCHAR}, #{item.createTime,jdbcType=TIMESTAMP})
        </foreach>
    </insert>
</mapper>