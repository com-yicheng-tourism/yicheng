<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yicheng.tourism.mapper.ext.CommentMapperExt">
    <select id="qry" parameterType="com.yicheng.tourism.dto.comment.req.QryCommentReq"
                    resultType="com.yicheng.tourism.dto.comment.resp.QryCommentResp">
        select
        t1.create_id createId,t1.serial_id commentId,t1.comment_text,t1.comment_img,t1.create_time,t2.profile_pic userPic, t2.nick_name nickName
        from t_comment t1,t_user t2
        <include refid="sql_where_qry"></include>
    </select>
    <sql id="sql_where_qry">
        <where>
        AND t1.user_id = t2.user_name
<!--            <if test="c.shopId != null and c.shopId != ''">-->
<!--                AND t1.shop_id = #{c.shopId}-->
                <if test="c.commodityId !=null and c.commodityId !=''">
                    AND t1.commodity_id = #{c.commodityId}
                </if>
            <!--</if>-->

        </where>
    </sql>
    <select id="qryReply" resultType="com.yicheng.tourism.dto.comment.resp.ReplyResp">
        select t1.comment_text,t1.create_time,t2.profile_pic userPic, t2.nick_name nickName
        from t_reply t1, t_user t2
        where comment_id = #{commentId} AND  t1.user_id = t2.user_name
    </select>

    <insert id="insert" parameterType="com.yicheng.tourism.entity.Comment">
        INSERT INTO t_comment
        (serial_id, user_id, shop_id,commodity_id, source_level,
        create_time,create_id,modify_time,modify_id,comment_text,comment_img,notes)
        VALUES
        (#{c.serialId,jdbcType=VARCHAR},
        #{c.userId,jdbcType=VARCHAR},
        #{c.shopId,jdbcType=VARCHAR},
        #{c.commodityId,jdbcType=VARCHAR},
        #{c.sourceLevel,jdbcType=VARCHAR},
        #{c.createTime,jdbcType=TIMESTAMP},
        #{c.createId,jdbcType=VARCHAR},
        #{c.modifyTime,jdbcType=TIMESTAMP},
        #{c.modifyId,jdbcType=VARCHAR},
        #{c.commentText,jdbcType=VARCHAR},
        #{c.commentImg,jdbcType=VARCHAR},
        #{c.notes,jdbcType=VARCHAR})
    </insert>
</mapper>